<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Coffee Shop - Accept Confidential Payments</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <script src="/sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #fff;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, #8B4513 0%, #654321 100%);
      padding: 20px 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 28px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .badge {
      background: #ec4899;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    /* Hero */
    .hero {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
    }
    
    .hero h1 {
      font-size: 48px;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #ec4899 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero p {
      font-size: 20px;
      color: #999;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Products Grid */
    .products {
      padding: 60px 20px;
    }
    
    .section-title {
      text-align: center;
      font-size: 36px;
      margin-bottom: 40px;
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .product-card {
      background: #2a2a2a;
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
      border: 2px solid transparent;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(236, 72, 153, 0.3);
      border-color: #ec4899;
    }
    
    .product-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, #654321 0%, #8B4513 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
    }
    
    .product-info {
      padding: 20px;
    }
    
    .product-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .product-description {
      color: #999;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .product-price {
      font-size: 28px;
      font-weight: bold;
      color: #ec4899;
    }
    
    .product-price-usd {
      font-size: 14px;
      color: #999;
      margin-top: 4px;
    }
    
    .btn {
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
    }
    
    .btn-primary:active {
      transform: scale(0.98);
    }
    
    /* Features */
    .features {
      background: #2a2a2a;
      padding: 60px 20px;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .feature {
      text-align: center;
    }
    
    .feature-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    
    .feature-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .feature-description {
      color: #999;
      font-size: 14px;
    }
    
    /* Footer */
    .footer {
      background: #1a1a1a;
      padding: 40px 20px;
      text-align: center;
      border-top: 1px solid #333;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .tech-info {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #ec4899;
    }
    
    .tech-info h3 {
      margin-bottom: 12px;
      color: #ec4899;
    }
    
    .tech-info p {
      color: #999;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .tech-info code {
      background: #1a1a1a;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
      color: #ec4899;
    }
    
    /* Payment Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: #2a2a2a;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: bold;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: #999;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: #333;
      color: #fff;
    }
    
    .status {
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
      text-align: center;
    }
    
    .status-success {
      background: rgba(34, 197, 94, 0.2);
      border: 1px solid rgba(34, 197, 94, 0.4);
      color: #22c55e;
    }
    
    .status-error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: #ef4444;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          ‚òï Crypto Coffee Shop
          <span class="badge">Powered by Aruvi</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Hero -->
  <div class="hero">
    <div class="container">
      <h1>Premium Coffee with Privacy</h1>
      <p>Pay with confidential tokens. Your purchase amounts stay private on-chain.</p>
    </div>
  </div>

  <!-- Products -->
  <div class="products">
    <div class="container">
      <h2 class="section-title">Our Menu</h2>
      <div class="products-grid">
        <!-- Espresso -->
        <div class="product-card">
          <div class="product-image">‚òï</div>
          <div class="product-info">
            <div class="product-name">Classic Espresso</div>
            <div class="product-description">Rich, bold espresso shot made from premium beans</div>
            <div class="product-footer">
              <div>
                <div class="product-price">üîí Encrypted</div>
                <div class="product-price-usd">Verified on Blockchain ‚úì</div>
              </div>
              <button class="btn btn-primary" onclick="buyProduct(0, 'Classic Espresso')">
                üîí Buy Now
              </button>
            </div>
          </div>
        </div>

        <!-- Cappuccino -->
        <div class="product-card">
          <div class="product-image">ü•õ</div>
          <div class="product-info">
            <div class="product-name">Cappuccino</div>
            <div class="product-description">Perfect balance of espresso, steamed milk, and foam</div>
            <div class="product-footer">
              <div>
                <div class="product-price">üîí Encrypted</div>
                <div class="product-price-usd">Verified on Blockchain ‚úì</div>
              </div>
              <button class="btn btn-primary" onclick="buyProduct(1, 'Cappuccino')">
                üîí Buy Now
              </button>
            </div>
          </div>
        </div>

        <!-- Cold Brew -->
        <div class="product-card">
          <div class="product-image">üßä</div>
          <div class="product-info">
            <div class="product-name">Cold Brew</div>
            <div class="product-description">Smooth, refreshing cold-brewed coffee</div>
            <div class="product-footer">
              <div>
                <div class="product-price">üîí Encrypted</div>
                <div class="product-price-usd">Verified on Blockchain ‚úì</div>
              </div>
              <button class="btn btn-primary" onclick="buyProduct(2, 'Cold Brew')">
                üîí Buy Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Features -->
  <div class="features">
    <div class="container">
      <h2 class="section-title">Why Choose Confidential Payments?</h2>
      <div class="features-grid">
        <div class="feature">
          <div class="feature-icon">üîí</div>
          <div class="feature-title">Private Transactions</div>
          <div class="feature-description">Payment amounts are encrypted on-chain. Nobody can see what you paid.</div>
        </div>
        <div class="feature">
          <div class="feature-icon">‚ö°</div>
          <div class="feature-title">Instant Settlement</div>
          <div class="feature-description">Payments settle on Ethereum in seconds. No intermediaries.</div>
        </div>
        <div class="feature">
          <div class="feature-icon">üõ°Ô∏è</div>
          <div class="feature-title">Fully Auditable</div>
          <div class="feature-description">Merchants can optionally disclose amounts for tax compliance.</div>
        </div>
        <div class="feature">
          <div class="feature-icon">üí∏</div>
          <div class="feature-title">Refund Support</div>
          <div class="feature-description">Built-in encrypted refund mechanism for customer protection.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-content">
      <div class="tech-info">
        <h3>üîß For Developers: Integration is Simple</h3>
        <p>This merchant website integrates Aruvi payments with just 3 lines of code:</p>
        <p style="margin-top: 12px;">
          <code>&lt;script src="https://aruvi.app/sdk.js"&gt;&lt;/script&gt;</code><br>
          <code>const aruvi = Aruvi.init({ merchantAddress: '0x...' });</code><br>
          <code>await aruvi.checkout({ amount: 5.0, orderId: 'ORDER-123' });</code>
        </p>
        <p style="margin-top: 12px;">
          Merchant Address: <code id="merchant-address">0x7E65E527Cbee544910EaF956b047479B0653b474</code>
        </p>
      </div>
      <p style="color: #666; font-size: 14px;">
        ¬© 2025 Crypto Coffee Shop - Demo powered by Aruvi Confidential Payment Gateway
      </p>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal" id="payment-modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Processing Payment</div>
        <button class="close-btn" onclick="closeModal()">√ó</button>
      </div>
      <div id="payment-status"></div>
    </div>
  </div>

  <script type="module">
    // Merchant configuration
    const MERCHANT_ADDRESS = '0x7E65E527Cbee544910EaF956b047479B0653b474';
    let aruviSDK;

    // Initialize SDK
    try {
      aruviSDK = Aruvi.init({
        merchantAddress: MERCHANT_ADDRESS,
        network: 'sepolia'
      });
      console.log('‚úÖ Aruvi SDK initialized');
    } catch (error) {
      console.error('‚ùå Failed to initialize Aruvi SDK:', error);
    }

    // Buy product using productId (seamless - fetches details from registry)
    // Buy product using trustless blockchain pricing
    async function buyProduct(productId, productName) {
      const modal = document.getElementById('payment-modal');
      const statusDiv = document.getElementById('payment-status');
      
      modal.classList.add('active');
      statusDiv.innerHTML = `
        <div style="text-align: center; padding: 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">‚òï</div>
          <div style="font-size: 18px; margin-bottom: 8px;">${productName}</div>
          <div style="color: #999; font-size: 14px; margin-bottom: 16px;">
            üîç Fetching blockchain-verified price...<br>
            <small style="color: #4ade80;">‚úì Trustless ‚Ä¢ Can't be manipulated</small>
          </div>
        </div>
      `;

      try {
        await aruviSDK.checkout({
          productId: productId, // SDK fetches price from ProductRegistry using merchant address + productId
          productName: productName,
          orderId: `ORDER-${Date.now()}`,
          metadata: {
            source: 'demo-shop',
            category: 'coffee'
          },
          onSuccess: (result) => {
            statusDiv.innerHTML = `
              <div class="status status-success">
                ‚úÖ Payment Successful!<br><br>
                <strong>Your ${productName} is being prepared!</strong><br><br>
                ‚úì Blockchain-verified pricing<br>
                ‚úì Encrypted amount (privacy protected)<br><br>
                Order ID: ${result.orderId}<br>
                Transaction: ${result.txHash ? result.txHash.substring(0, 10) + '...' : 'Confirmed'}<br><br>
                <button class="btn btn-primary" onclick="closeModal()">Close</button>
              </div>
            `;
          },
          onError: (error) => {
            statusDiv.innerHTML = `
              <div class="status status-error">
                ‚ùå Payment Failed<br><br>
                ${error.message || 'Unknown error'}<br><br>
                <small>Possible reasons:</small><br>
                <small>‚Ä¢ Product ID ${productId} not registered for this merchant</small><br>
                <small>‚Ä¢ Network connection issue</small><br>
                <small>‚Ä¢ User cancelled payment</small><br><br>
                <button class="btn btn-primary" onclick="closeModal()">Try Again</button>
              </div>
            `;
          }
        });
      } catch (error) {
        statusDiv.innerHTML = `
          <div class="status status-error">
            ‚ùå Error: ${error.message}<br><br>
            <small>Register products in ProductRegistry:</small><br>
            <small>1. Go to Aruvi dashboard</small><br>
            <small>2. Register 3 products (they get IDs 0, 1, 2)</small><br>
            <small>3. Match product order: Espresso=0, Cappuccino=1, Cold Brew=2</small><br><br>
            <button class="btn btn-primary" onclick="closeModal()">Close</button>
          </div>
        `;
      }
    }

    // Close modal
    function closeModal() {
      document.getElementById('payment-modal').classList.remove('active');
    }

    // Make functions available globally for onclick handlers
    window.buyProduct = buyProduct;
    window.closeModal = closeModal;

    // Check for payment callback
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('status') === 'success') {
      const modal = document.getElementById('payment-modal');
      const statusDiv = document.getElementById('payment-status');
      
      modal.classList.add('active');
      statusDiv.innerHTML = `
        <div class="status status-success">
          ‚úÖ Payment Successful!<br><br>
          <strong>Your order is confirmed!</strong><br><br>
          Order ID: ${urlParams.get('orderId') || 'N/A'}<br>
          Payment ID: ${urlParams.get('paymentId')?.substring(0, 10) || 'N/A'}...<br>
          Transaction: ${urlParams.get('txHash')?.substring(0, 10) || 'N/A'}...<br><br>
          <button class="btn btn-primary" onclick="closeModal()">Close</button>
        </div>
      `;
    }
  </script>
</body>
</html>
