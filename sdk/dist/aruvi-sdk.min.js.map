{"version":3,"file":"aruvi-sdk.min.js","sources":["../src/constants.ts","../src/CheckoutModal.ts","../src/AruviButton.ts","../src/verify.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Aruvi SDK Constants\r\n * Contract addresses, ABIs, and configuration\r\n */\r\n\r\n// ============================================================================\r\n// Contract Addresses\r\n// ============================================================================\r\n\r\nexport const CONTRACTS = {\r\n  testnet: {\r\n    PaymentGateway: '0xf2Dd4FC2114e524E9B53d9F608e7484E1CD3271b' as const,\r\n    ConfidentialUSDCWrapper: '0xf99376BE228E8212C3C9b8B746683C96C1517e8B' as const,\r\n    chainId: 11155111,\r\n    chainName: 'Sepolia',\r\n    rpcUrl: 'https://rpc.sepolia.org', // Default public RPC - override with custom rpcUrl in config\r\n  },\r\n  mainnet: {\r\n    PaymentGateway: '0x...' as const, // Add when mainnet deployed\r\n    ConfidentialUSDCWrapper: '0x...' as const,\r\n    chainId: 1,\r\n    chainName: 'Ethereum',\r\n    rpcUrl: 'https://eth.llamarpc.com',\r\n  },\r\n} as const;\r\n\r\n// ============================================================================\r\n// Default Configuration\r\n// ============================================================================\r\n\r\nexport const DEFAULTS = {\r\n  appUrl: {\r\n    testnet: 'http://localhost:5173', // Change to https://testnet.aruvi.io when deployed\r\n    mainnet: 'https://app.aruvi.io',\r\n  },\r\n  theme: {\r\n    primaryColor: '#0070ba',\r\n    secondaryColor: '#003087',\r\n    borderRadius: 12,\r\n    fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\r\n  },\r\n} as const;\r\n\r\n// ============================================================================\r\n// Payment Gateway ABI (simplified for SDK)\r\n// ============================================================================\r\n\r\nexport const PAYMENT_GATEWAY_ABI = [\r\n  {\r\n    name: 'PaymentSent',\r\n    type: 'event',\r\n    inputs: [\r\n      { name: 'paymentId', type: 'bytes32', indexed: true },\r\n      { name: 'from', type: 'address', indexed: true },\r\n      { name: 'to', type: 'address', indexed: true },\r\n    ],\r\n  },\r\n  {\r\n    name: 'PaymentRefunded',\r\n    type: 'event',\r\n    inputs: [\r\n      { name: 'paymentId', type: 'bytes32', indexed: true },\r\n    ],\r\n  },\r\n  {\r\n    name: 'getPaymentInfo',\r\n    type: 'function',\r\n    stateMutability: 'view',\r\n    inputs: [{ name: 'paymentId', type: 'bytes32' }],\r\n    outputs: [\r\n      { name: 'sender', type: 'address' },\r\n      { name: 'recipient', type: 'address' },\r\n      { name: 'token', type: 'address' },\r\n      { name: 'timestamp', type: 'uint256' },\r\n      { name: 'isRefunded', type: 'bool' },\r\n    ],\r\n  },\r\n  {\r\n    name: 'refunded',\r\n    type: 'function',\r\n    stateMutability: 'view',\r\n    inputs: [{ name: '', type: 'bytes32' }],\r\n    outputs: [{ name: '', type: 'bool' }],\r\n  },\r\n] as const;\r\n\r\n// ============================================================================\r\n// Checkout Iframe Messages\r\n// ============================================================================\r\n\r\nexport const MESSAGE_TYPES = {\r\n  // From merchant to checkout\r\n  INIT_CHECKOUT: 'ARUVI_INIT_CHECKOUT',\r\n  CLOSE_CHECKOUT: 'ARUVI_CLOSE_CHECKOUT',\r\n  \r\n  // From checkout to merchant\r\n  CHECKOUT_READY: 'ARUVI_CHECKOUT_READY',\r\n  CHECKOUT_CLOSED: 'ARUVI_CHECKOUT_CLOSED',\r\n  PAYMENT_PENDING: 'ARUVI_PAYMENT_PENDING',\r\n  PAYMENT_SUCCESS: 'ARUVI_PAYMENT_SUCCESS',\r\n  PAYMENT_ERROR: 'ARUVI_PAYMENT_ERROR',\r\n  PAYMENT_CANCELLED: 'ARUVI_PAYMENT_CANCELLED',\r\n} as const;\r\n\r\n// ============================================================================\r\n// Styling\r\n// ============================================================================\r\n\r\nexport const BUTTON_STYLES = {\r\n  base: `\r\n    display: inline-flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: 8px;\r\n    font-weight: 600;\r\n    cursor: pointer;\r\n    transition: all 0.2s ease;\r\n    border: none;\r\n    text-decoration: none;\r\n  `,\r\n  sizes: {\r\n    small: `\r\n      height: 36px;\r\n      padding: 0 16px;\r\n      font-size: 14px;\r\n      border-radius: 8px;\r\n    `,\r\n    medium: `\r\n      height: 44px;\r\n      padding: 0 24px;\r\n      font-size: 15px;\r\n      border-radius: 10px;\r\n    `,\r\n    large: `\r\n      height: 52px;\r\n      padding: 0 32px;\r\n      font-size: 16px;\r\n      border-radius: 12px;\r\n    `,\r\n  },\r\n  variants: {\r\n    primary: `\r\n      background: linear-gradient(135deg, #0070ba 0%, #003087 100%);\r\n      color: #ffffff;\r\n    `,\r\n    secondary: `\r\n      background: #f5f7fa;\r\n      color: #003087;\r\n    `,\r\n    outline: `\r\n      background: transparent;\r\n      color: #0070ba;\r\n      border: 2px solid #0070ba;\r\n    `,\r\n    dark: `\r\n      background: #1a1a1a;\r\n      color: #ffffff;\r\n    `,\r\n  },\r\n  hover: {\r\n    primary: 'filter: brightness(1.1); transform: translateY(-1px);',\r\n    secondary: 'background: #e8ecf2;',\r\n    outline: 'background: rgba(0, 112, 186, 0.08);',\r\n    dark: 'background: #2a2a2a;',\r\n  },\r\n  disabled: `\r\n    opacity: 0.5;\r\n    cursor: not-allowed;\r\n    pointer-events: none;\r\n  `,\r\n} as const;\r\n\r\nexport const MODAL_STYLES = `\r\n  .aruvi-modal-overlay {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.6);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 999999;\r\n    animation: aruvi-fade-in 0.2s ease;\r\n  }\r\n  \r\n  .aruvi-modal-container {\r\n    background: #ffffff;\r\n    border-radius: 16px;\r\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n    width: 100%;\r\n    max-width: 420px;\r\n    max-height: 90vh;\r\n    overflow: hidden;\r\n    animation: aruvi-slide-up 0.3s ease;\r\n    position: relative;\r\n  }\r\n  \r\n  .aruvi-modal-header {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 16px 20px;\r\n    border-bottom: 1px solid #e5e7eb;\r\n    background: linear-gradient(135deg, #0070ba 0%, #003087 100%);\r\n    color: white;\r\n  }\r\n  \r\n  .aruvi-modal-title {\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n  \r\n  .aruvi-modal-close {\r\n    background: rgba(255, 255, 255, 0.2);\r\n    border: none;\r\n    width: 32px;\r\n    height: 32px;\r\n    border-radius: 50%;\r\n    cursor: pointer;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: white;\r\n    transition: background 0.2s;\r\n  }\r\n  \r\n  .aruvi-modal-close:hover {\r\n    background: rgba(255, 255, 255, 0.3);\r\n  }\r\n  \r\n  .aruvi-modal-content {\r\n    padding: 0;\r\n  }\r\n  \r\n  .aruvi-modal-iframe {\r\n    width: 100%;\r\n    height: 500px;\r\n    border: none;\r\n  }\r\n  \r\n  .aruvi-modal-loading {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 300px;\r\n    gap: 16px;\r\n    color: #6b7280;\r\n  }\r\n  \r\n  .aruvi-spinner {\r\n    width: 40px;\r\n    height: 40px;\r\n    border: 3px solid #e5e7eb;\r\n    border-top-color: #0070ba;\r\n    border-radius: 50%;\r\n    animation: aruvi-spin 1s linear infinite;\r\n  }\r\n  \r\n  @keyframes aruvi-fade-in {\r\n    from { opacity: 0; }\r\n    to { opacity: 1; }\r\n  }\r\n  \r\n  @keyframes aruvi-slide-up {\r\n    from { \r\n      opacity: 0; \r\n      transform: translateY(20px) scale(0.95); \r\n    }\r\n    to { \r\n      opacity: 1; \r\n      transform: translateY(0) scale(1); \r\n    }\r\n  }\r\n  \r\n  @keyframes aruvi-spin {\r\n    to { transform: rotate(360deg); }\r\n  }\r\n  \r\n  @media (max-width: 480px) {\r\n    .aruvi-modal-container {\r\n      max-width: 100%;\r\n      max-height: 100%;\r\n      height: 100%;\r\n      border-radius: 0;\r\n    }\r\n    \r\n    .aruvi-modal-iframe {\r\n      height: calc(100vh - 60px);\r\n    }\r\n  }\r\n`;\r\n\r\n// ============================================================================\r\n// Logo SVG\r\n// ============================================================================\r\n\r\nexport const ARUVI_LOGO_SVG = `\r\n<svg width=\"24\" height=\"24\" viewBox=\"0 0 32 32\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n  <circle cx=\"16\" cy=\"16\" r=\"14\" fill=\"currentColor\" opacity=\"0.2\"/>\r\n  <path d=\"M10 20L16 12L22 20\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n  <path d=\"M13 16L16 12L19 16\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n</svg>\r\n`;\r\n","/**\r\n * Aruvi Checkout Modal\r\n * Handles the checkout popup/modal for processing payments\r\n */\r\n\r\nimport type {\r\n  AruviConfig,\r\n  PaymentRequest,\r\n  AruviCallbacks,\r\n  PaymentResult,\r\n  PaymentError,\r\n} from './types';\r\nimport { DEFAULTS, MESSAGE_TYPES, MODAL_STYLES, ARUVI_LOGO_SVG } from './constants';\r\n\r\nexport class CheckoutModal {\r\n  private config: AruviConfig;\r\n  private modal: HTMLDivElement | null = null;\r\n  private iframe: HTMLIFrameElement | null = null;\r\n  private callbacks: AruviCallbacks = {};\r\n  private styleElement: HTMLStyleElement | null = null;\r\n  private messageHandler: ((event: MessageEvent) => void) | null = null;\r\n\r\n  constructor(config: AruviConfig) {\r\n    this.config = config;\r\n    this.injectStyles();\r\n  }\r\n\r\n  /**\r\n   * Inject modal styles into the document\r\n   */\r\n  private injectStyles(): void {\r\n    if (this.styleElement || document.getElementById('aruvi-modal-styles')) {\r\n      return;\r\n    }\r\n\r\n    this.styleElement = document.createElement('style');\r\n    this.styleElement.id = 'aruvi-modal-styles';\r\n    this.styleElement.textContent = MODAL_STYLES;\r\n    \r\n    // Apply custom theme\r\n    if (this.config.theme) {\r\n      let customStyles = '';\r\n      if (this.config.theme.primaryColor) {\r\n        customStyles += `\r\n          .aruvi-modal-header {\r\n            background: ${this.config.theme.primaryColor};\r\n          }\r\n          .aruvi-spinner {\r\n            border-top-color: ${this.config.theme.primaryColor};\r\n          }\r\n        `;\r\n      }\r\n      if (this.config.theme.borderRadius !== undefined) {\r\n        customStyles += `\r\n          .aruvi-modal-container {\r\n            border-radius: ${this.config.theme.borderRadius}px;\r\n          }\r\n        `;\r\n      }\r\n      if (this.config.theme.fontFamily) {\r\n        customStyles += `\r\n          .aruvi-modal-overlay, .aruvi-modal-container {\r\n            font-family: ${this.config.theme.fontFamily};\r\n          }\r\n        `;\r\n      }\r\n      this.styleElement.textContent += customStyles;\r\n    }\r\n    \r\n    document.head.appendChild(this.styleElement);\r\n  }\r\n\r\n  /**\r\n   * Get the app URL based on environment\r\n   */\r\n  private getAppUrl(): string {\r\n    if (this.config.appUrl) {\r\n      return this.config.appUrl;\r\n    }\r\n    const env = this.config.environment || 'testnet';\r\n    return DEFAULTS.appUrl[env];\r\n  }\r\n\r\n  /**\r\n   * Build the checkout URL with parameters\r\n   */\r\n  private buildCheckoutUrl(payment: PaymentRequest): string {\r\n    const baseUrl = this.getAppUrl();\r\n    const params = new URLSearchParams();\r\n    \r\n    // Required parameters\r\n    params.set('merchant', this.config.merchantAddress);\r\n    params.set('amount', payment.amount);\r\n    params.set('sdk', 'true');\r\n    \r\n    // Optional parameters\r\n    if (payment.reference) params.set('ref', payment.reference);\r\n    if (payment.description) params.set('desc', payment.description);\r\n    if (payment.customerEmail) params.set('email', payment.customerEmail);\r\n    if (payment.metadata) params.set('meta', JSON.stringify(payment.metadata));\r\n    if (payment.successUrl) params.set('success', payment.successUrl);\r\n    if (payment.cancelUrl) params.set('cancel', payment.cancelUrl);\r\n    \r\n    return `${baseUrl}/checkout?${params.toString()}`;\r\n  }\r\n\r\n  /**\r\n   * Create the modal DOM structure\r\n   */\r\n  private createModal(payment: PaymentRequest): HTMLDivElement {\r\n    const overlay = document.createElement('div');\r\n    overlay.className = 'aruvi-modal-overlay';\r\n    overlay.setAttribute('role', 'dialog');\r\n    overlay.setAttribute('aria-modal', 'true');\r\n    overlay.setAttribute('aria-labelledby', 'aruvi-modal-title');\r\n\r\n    const container = document.createElement('div');\r\n    container.className = 'aruvi-modal-container';\r\n\r\n    // Header\r\n    const header = document.createElement('div');\r\n    header.className = 'aruvi-modal-header';\r\n\r\n    const title = document.createElement('div');\r\n    title.className = 'aruvi-modal-title';\r\n    title.id = 'aruvi-modal-title';\r\n    title.innerHTML = `${ARUVI_LOGO_SVG} <span>Aruvi Checkout</span>`;\r\n\r\n    const closeBtn = document.createElement('button');\r\n    closeBtn.className = 'aruvi-modal-close';\r\n    closeBtn.setAttribute('aria-label', 'Close checkout');\r\n    closeBtn.innerHTML = `\r\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n        <path d=\"M18 6L6 18M6 6l12 12\"/>\r\n      </svg>\r\n    `;\r\n    closeBtn.onclick = () => this.close(true);\r\n\r\n    header.appendChild(title);\r\n    header.appendChild(closeBtn);\r\n\r\n    // Content\r\n    const content = document.createElement('div');\r\n    content.className = 'aruvi-modal-content';\r\n\r\n    // Loading state\r\n    const loading = document.createElement('div');\r\n    loading.className = 'aruvi-modal-loading';\r\n    loading.innerHTML = `\r\n      <div class=\"aruvi-spinner\"></div>\r\n      <p>Loading secure checkout...</p>\r\n    `;\r\n    content.appendChild(loading);\r\n\r\n    // Iframe\r\n    const iframe = document.createElement('iframe');\r\n    iframe.className = 'aruvi-modal-iframe';\r\n    iframe.style.display = 'none';\r\n    iframe.src = this.buildCheckoutUrl(payment);\r\n    iframe.setAttribute('allow', 'clipboard-write; web3');\r\n    iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox');\r\n    \r\n    iframe.onload = () => {\r\n      loading.style.display = 'none';\r\n      iframe.style.display = 'block';\r\n    };\r\n\r\n    content.appendChild(iframe);\r\n    this.iframe = iframe;\r\n\r\n    container.appendChild(header);\r\n    container.appendChild(content);\r\n    overlay.appendChild(container);\r\n\r\n    // Close on overlay click\r\n    overlay.onclick = (e) => {\r\n      if (e.target === overlay) {\r\n        this.close(true);\r\n      }\r\n    };\r\n\r\n    // Close on Escape key\r\n    const escapeHandler = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        this.close(true);\r\n        document.removeEventListener('keydown', escapeHandler);\r\n      }\r\n    };\r\n    document.addEventListener('keydown', escapeHandler);\r\n\r\n    return overlay;\r\n  }\r\n\r\n  /**\r\n   * Setup message listener for iframe communication\r\n   */\r\n  private setupMessageListener(): void {\r\n    this.messageHandler = (event: MessageEvent) => {\r\n      // Validate origin\r\n      const appUrl = this.getAppUrl();\r\n      if (!event.origin.includes(new URL(appUrl).host)) {\r\n        return;\r\n      }\r\n\r\n      const { type, data } = event.data || {};\r\n\r\n      switch (type) {\r\n        case MESSAGE_TYPES.CHECKOUT_READY:\r\n          // Checkout loaded successfully\r\n          break;\r\n\r\n        case MESSAGE_TYPES.PAYMENT_PENDING:\r\n          this.callbacks.onPending?.(data.transactionHash);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.PAYMENT_SUCCESS:\r\n          const result: PaymentResult = {\r\n            success: true,\r\n            paymentId: data.paymentId,\r\n            transactionHash: data.transactionHash,\r\n            amount: data.amount,\r\n            customerAddress: data.customerAddress,\r\n            merchantAddress: this.config.merchantAddress,\r\n            blockNumber: data.blockNumber,\r\n            timestamp: data.timestamp,\r\n            reference: data.reference,\r\n            metadata: data.metadata,\r\n          };\r\n          this.callbacks.onSuccess?.(result);\r\n          this.close(false);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.PAYMENT_ERROR:\r\n          const error: PaymentError = {\r\n            code: data.code || 'UNKNOWN',\r\n            message: data.message || 'Payment failed',\r\n            originalError: data.originalError,\r\n          };\r\n          this.callbacks.onError?.(error);\r\n          break;\r\n\r\n        case MESSAGE_TYPES.PAYMENT_CANCELLED:\r\n        case MESSAGE_TYPES.CHECKOUT_CLOSED:\r\n          this.close(true);\r\n          break;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('message', this.messageHandler);\r\n  }\r\n\r\n  /**\r\n   * Open the checkout modal\r\n   */\r\n  open(payment: PaymentRequest, callbacks: AruviCallbacks = {}): void {\r\n    // Close any existing modal\r\n    if (this.modal) {\r\n      this.close(false);\r\n    }\r\n\r\n    this.callbacks = callbacks;\r\n    this.modal = this.createModal(payment);\r\n    this.setupMessageListener();\r\n\r\n    // Add to DOM\r\n    document.body.appendChild(this.modal);\r\n    document.body.style.overflow = 'hidden';\r\n\r\n    // Trigger callback\r\n    this.callbacks.onOpen?.();\r\n  }\r\n\r\n  /**\r\n   * Close the checkout modal\r\n   */\r\n  close(cancelled: boolean = false): void {\r\n    if (!this.modal) return;\r\n\r\n    // Remove message listener\r\n    if (this.messageHandler) {\r\n      window.removeEventListener('message', this.messageHandler);\r\n      this.messageHandler = null;\r\n    }\r\n\r\n    // Remove modal\r\n    this.modal.remove();\r\n    this.modal = null;\r\n    this.iframe = null;\r\n    document.body.style.overflow = '';\r\n\r\n    // Trigger callbacks\r\n    this.callbacks.onClose?.();\r\n    if (cancelled) {\r\n      this.callbacks.onCancel?.();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if modal is currently open\r\n   */\r\n  isOpen(): boolean {\r\n    return this.modal !== null;\r\n  }\r\n\r\n  /**\r\n   * Destroy the checkout modal and cleanup\r\n   */\r\n  destroy(): void {\r\n    this.close(false);\r\n    if (this.styleElement) {\r\n      this.styleElement.remove();\r\n      this.styleElement = null;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Aruvi Button\r\n * Embeddable \"Pay with Aruvi\" button for vanilla JS\r\n */\r\n\r\nimport type { AruviButtonOptions, ButtonVariant, ButtonSize } from './types';\r\nimport { BUTTON_STYLES, ARUVI_LOGO_SVG } from './constants';\r\n\r\nexport class AruviButton {\r\n  private container: HTMLElement;\r\n  private button: HTMLButtonElement | null = null;\r\n  private options: Required<AruviButtonOptions>;\r\n  private clickHandler: (() => void) | null = null;\r\n\r\n  private static defaultOptions: Required<AruviButtonOptions> = {\r\n    label: 'Pay with Aruvi',\r\n    variant: 'primary',\r\n    size: 'medium',\r\n    showLogo: true,\r\n    disabled: false,\r\n    className: '',\r\n  };\r\n\r\n  constructor(\r\n    container: HTMLElement | string,\r\n    options: AruviButtonOptions = {}\r\n  ) {\r\n    // Get container element\r\n    if (typeof container === 'string') {\r\n      const el = document.querySelector(container);\r\n      if (!el) {\r\n        throw new Error(`Aruvi: Container element \"${container}\" not found`);\r\n      }\r\n      this.container = el as HTMLElement;\r\n    } else {\r\n      this.container = container;\r\n    }\r\n\r\n    this.options = { ...AruviButton.defaultOptions, ...options };\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Generate button styles\r\n   */\r\n  private getStyles(): string {\r\n    const { variant, size, disabled } = this.options;\r\n    \r\n    let styles = BUTTON_STYLES.base;\r\n    styles += BUTTON_STYLES.sizes[size];\r\n    styles += BUTTON_STYLES.variants[variant];\r\n    \r\n    if (disabled) {\r\n      styles += BUTTON_STYLES.disabled;\r\n    }\r\n\r\n    return styles.replace(/\\s+/g, ' ').trim();\r\n  }\r\n\r\n  /**\r\n   * Render the button\r\n   */\r\n  private render(): void {\r\n    this.button = document.createElement('button');\r\n    this.button.type = 'button';\r\n    this.button.className = `aruvi-button ${this.options.className}`.trim();\r\n    this.button.disabled = this.options.disabled;\r\n    this.button.setAttribute('style', this.getStyles());\r\n\r\n    // Content\r\n    let content = '';\r\n    if (this.options.showLogo) {\r\n      content += `<span class=\"aruvi-button-logo\">${ARUVI_LOGO_SVG}</span>`;\r\n    }\r\n    content += `<span class=\"aruvi-button-label\">${this.options.label}</span>`;\r\n    this.button.innerHTML = content;\r\n\r\n    // Hover effects\r\n    const variant = this.options.variant;\r\n    this.button.onmouseenter = () => {\r\n      if (!this.options.disabled && this.button) {\r\n        this.button.setAttribute('style', this.getStyles() + BUTTON_STYLES.hover[variant]);\r\n      }\r\n    };\r\n    this.button.onmouseleave = () => {\r\n      if (this.button) {\r\n        this.button.setAttribute('style', this.getStyles());\r\n      }\r\n    };\r\n\r\n    // Clear container and append button\r\n    this.container.innerHTML = '';\r\n    this.container.appendChild(this.button);\r\n  }\r\n\r\n  /**\r\n   * Set click handler\r\n   */\r\n  onClick(handler: () => void): AruviButton {\r\n    this.clickHandler = handler;\r\n    if (this.button) {\r\n      this.button.onclick = handler;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Update button options\r\n   */\r\n  update(options: Partial<AruviButtonOptions>): AruviButton {\r\n    this.options = { ...this.options, ...options };\r\n    this.render();\r\n    if (this.clickHandler) {\r\n      this.onClick(this.clickHandler);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set loading state\r\n   */\r\n  setLoading(loading: boolean): AruviButton {\r\n    if (!this.button) return this;\r\n\r\n    if (loading) {\r\n      this.button.disabled = true;\r\n      this.button.innerHTML = `\r\n        <span class=\"aruvi-spinner\" style=\"\r\n          width: 20px;\r\n          height: 20px;\r\n          border: 2px solid currentColor;\r\n          border-top-color: transparent;\r\n          border-radius: 50%;\r\n          animation: aruvi-spin 1s linear infinite;\r\n        \"></span>\r\n        <span>Processing...</span>\r\n      `;\r\n      \r\n      // Add animation if not already present\r\n      if (!document.getElementById('aruvi-button-styles')) {\r\n        const style = document.createElement('style');\r\n        style.id = 'aruvi-button-styles';\r\n        style.textContent = `\r\n          @keyframes aruvi-spin {\r\n            to { transform: rotate(360deg); }\r\n          }\r\n        `;\r\n        document.head.appendChild(style);\r\n      }\r\n    } else {\r\n      this.button.disabled = this.options.disabled;\r\n      this.render();\r\n      if (this.clickHandler) {\r\n        this.onClick(this.clickHandler);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Enable the button\r\n   */\r\n  enable(): AruviButton {\r\n    this.options.disabled = false;\r\n    if (this.button) {\r\n      this.button.disabled = false;\r\n      this.button.setAttribute('style', this.getStyles());\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Disable the button\r\n   */\r\n  disable(): AruviButton {\r\n    this.options.disabled = true;\r\n    if (this.button) {\r\n      this.button.disabled = true;\r\n      this.button.setAttribute('style', this.getStyles());\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Get the button element\r\n   */\r\n  getElement(): HTMLButtonElement | null {\r\n    return this.button;\r\n  }\r\n\r\n  /**\r\n   * Destroy the button\r\n   */\r\n  destroy(): void {\r\n    if (this.button) {\r\n      this.button.remove();\r\n      this.button = null;\r\n    }\r\n    this.clickHandler = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Factory function to create buttons\r\n */\r\nexport function createAruviButton(\r\n  container: HTMLElement | string,\r\n  options?: AruviButtonOptions\r\n): AruviButton {\r\n  return new AruviButton(container, options);\r\n}\r\n","/**\r\n * Aruvi Payment Verification\r\n * Server-side utilities for verifying payments\r\n */\r\n\r\nimport type { VerificationResult, PaymentResult } from './types';\r\nimport { CONTRACTS, PAYMENT_GATEWAY_ABI } from './constants';\r\n\r\nexport interface VerifyOptions {\r\n  /**\r\n   * Payment ID to verify\r\n   */\r\n  paymentId: `0x${string}`;\r\n  \r\n  /**\r\n   * Expected merchant address\r\n   */\r\n  merchantAddress: `0x${string}`;\r\n  \r\n  /**\r\n   * Expected amount (optional - for additional validation)\r\n   */\r\n  expectedAmount?: string;\r\n  \r\n  /**\r\n   * Environment: 'testnet' or 'mainnet'\r\n   */\r\n  environment?: 'testnet' | 'mainnet';\r\n  \r\n  /**\r\n   * Custom RPC URL\r\n   */\r\n  rpcUrl?: string;\r\n}\r\n\r\n/**\r\n * Verify a payment on the blockchain\r\n * Can be used server-side with any HTTP client\r\n */\r\nexport async function verifyPayment(options: VerifyOptions): Promise<VerificationResult> {\r\n  const env = options.environment || 'testnet';\r\n  const rpcUrl = options.rpcUrl || CONTRACTS[env].rpcUrl;\r\n  const contractAddress = CONTRACTS[env].PaymentGateway;\r\n\r\n  try {\r\n    // Encode the function call for getPaymentInfo(bytes32 paymentId)\r\n    // Function selector: keccak256(\"getPaymentInfo(bytes32)\").slice(0, 10)\r\n    const functionSelector = '0xc6610657'; // getPaymentInfo(bytes32)\r\n    const encodedPaymentId = options.paymentId.slice(2).padStart(64, '0');\r\n    const data = functionSelector + encodedPaymentId;\r\n\r\n    // Make RPC call\r\n    const response = await fetch(rpcUrl, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        jsonrpc: '2.0',\r\n        id: 1,\r\n        method: 'eth_call',\r\n        params: [\r\n          {\r\n            to: contractAddress,\r\n            data: data,\r\n          },\r\n          'latest',\r\n        ],\r\n      }),\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    if (result.error) {\r\n      return {\r\n        verified: false,\r\n        error: result.error.message || 'RPC error',\r\n      };\r\n    }\r\n\r\n    // Decode the result\r\n    const decoded = decodePaymentResult(result.result);\r\n\r\n    if (!decoded) {\r\n      return {\r\n        verified: false,\r\n        error: 'Payment not found',\r\n      };\r\n    }\r\n\r\n    // Validate merchant address\r\n    if (decoded.recipient.toLowerCase() !== options.merchantAddress.toLowerCase()) {\r\n      return {\r\n        verified: false,\r\n        error: 'Merchant address mismatch',\r\n      };\r\n    }\r\n\r\n    // Check if payment was refunded\r\n    if (decoded.isRefunded) {\r\n      return {\r\n        verified: false,\r\n        error: 'Payment was refunded',\r\n      };\r\n    }\r\n\r\n    // Note: Amount is encrypted on-chain, so we cannot verify it here\r\n    // The amount validation must be done through other means if needed\r\n\r\n    const payment: PaymentResult = {\r\n      success: true,\r\n      paymentId: options.paymentId,\r\n      transactionHash: '0x' as `0x${string}`, // Would need additional lookup\r\n      amount: '0', // Amount is encrypted - cannot be read from chain\r\n      customerAddress: decoded.sender as `0x${string}`,\r\n      merchantAddress: decoded.recipient as `0x${string}`,\r\n      blockNumber: 0, // Would need additional lookup\r\n      timestamp: decoded.timestamp,\r\n    };\r\n\r\n    return {\r\n      verified: true,\r\n      payment,\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      verified: false,\r\n      error: error instanceof Error ? error.message : 'Verification failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Decode payment result from RPC response\r\n * Returns: (address sender, address recipient, address token, uint256 timestamp, bool isRefunded)\r\n */\r\nfunction decodePaymentResult(hexData: string): {\r\n  sender: string;\r\n  recipient: string;\r\n  token: string;\r\n  timestamp: number;\r\n  isRefunded: boolean;\r\n} | null {\r\n  if (!hexData || hexData === '0x' || hexData.length < 66) {\r\n    return null;\r\n  }\r\n\r\n  // Remove '0x' prefix\r\n  const data = hexData.slice(2);\r\n\r\n  // Decode: (address sender, address recipient, address token, uint256 timestamp, bool isRefunded)\r\n  const sender = '0x' + data.slice(24, 64);\r\n  const recipient = '0x' + data.slice(88, 128);\r\n  const token = '0x' + data.slice(152, 192);\r\n  const timestamp = parseInt(data.slice(192, 256), 16);\r\n  const isRefunded = parseInt(data.slice(256, 320), 16) !== 0;\r\n\r\n  // Check if payment exists (sender should not be zero address)\r\n  if (sender === '0x0000000000000000000000000000000000000000') {\r\n    return null;\r\n  }\r\n\r\n  return { sender, recipient, token, timestamp, isRefunded };\r\n}\r\n\r\n/**\r\n * Parse units (like ethers.parseUnits)\r\n */\r\nfunction parseUnits(value: string, decimals: number): bigint {\r\n  const [whole, fraction = ''] = value.split('.');\r\n  const paddedFraction = fraction.padEnd(decimals, '0').slice(0, decimals);\r\n  return BigInt(whole + paddedFraction);\r\n}\r\n\r\n/**\r\n * Format units (like ethers.formatUnits)\r\n */\r\nfunction formatUnits(value: bigint, decimals: number): string {\r\n  const str = value.toString().padStart(decimals + 1, '0');\r\n  const whole = str.slice(0, -decimals) || '0';\r\n  const fraction = str.slice(-decimals).replace(/0+$/, '');\r\n  return fraction ? `${whole}.${fraction}` : whole;\r\n}\r\n\r\n/**\r\n * Verify payment by transaction hash\r\n */\r\nexport async function verifyPaymentByTxHash(\r\n  transactionHash: `0x${string}`,\r\n  options: {\r\n    merchantAddress: `0x${string}`;\r\n    environment?: 'testnet' | 'mainnet';\r\n    rpcUrl?: string;\r\n  }\r\n): Promise<VerificationResult> {\r\n  const env = options.environment || 'testnet';\r\n  const rpcUrl = options.rpcUrl || CONTRACTS[env].rpcUrl;\r\n\r\n  try {\r\n    // Get transaction receipt\r\n    const receiptResponse = await fetch(rpcUrl, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        jsonrpc: '2.0',\r\n        id: 1,\r\n        method: 'eth_getTransactionReceipt',\r\n        params: [transactionHash],\r\n      }),\r\n    });\r\n\r\n    const receiptResult = await receiptResponse.json();\r\n\r\n    if (receiptResult.error || !receiptResult.result) {\r\n      return {\r\n        verified: false,\r\n        error: 'Transaction not found',\r\n      };\r\n    }\r\n\r\n    const receipt = receiptResult.result;\r\n\r\n    // Check transaction status\r\n    if (receipt.status !== '0x1') {\r\n      return {\r\n        verified: false,\r\n        error: 'Transaction failed',\r\n      };\r\n    }\r\n\r\n    // Look for PaymentSent event\r\n    // PaymentSent(bytes32 indexed paymentId, address indexed sender, address indexed recipient, uint256 amount)\r\n    const paymentSentTopic = '0x' + 'PaymentSent(bytes32,address,address,uint256)'\r\n      .split('')\r\n      .reduce((acc, char) => acc + char.charCodeAt(0).toString(16), '')\r\n      .padEnd(64, '0'); // Simplified - in production, use proper keccak256\r\n\r\n    const paymentLog = receipt.logs?.find((log: any) => \r\n      log.address.toLowerCase() === CONTRACTS[env].PaymentGateway.toLowerCase()\r\n    );\r\n\r\n    if (!paymentLog) {\r\n      return {\r\n        verified: false,\r\n        error: 'Payment event not found in transaction',\r\n      };\r\n    }\r\n\r\n    // Extract payment details from log\r\n    const paymentId = paymentLog.topics[1] as `0x${string}`;\r\n    const sender = ('0x' + paymentLog.topics[2].slice(26)) as `0x${string}`;\r\n    const recipient = ('0x' + paymentLog.topics[3].slice(26)) as `0x${string}`;\r\n    const amount = BigInt(paymentLog.data);\r\n\r\n    // Validate merchant\r\n    if (recipient.toLowerCase() !== options.merchantAddress.toLowerCase()) {\r\n      return {\r\n        verified: false,\r\n        error: 'Merchant address mismatch',\r\n      };\r\n    }\r\n\r\n    const payment: PaymentResult = {\r\n      success: true,\r\n      paymentId,\r\n      transactionHash,\r\n      amount: formatUnits(amount, 6),\r\n      customerAddress: sender,\r\n      merchantAddress: recipient,\r\n      blockNumber: parseInt(receipt.blockNumber, 16),\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    return {\r\n      verified: true,\r\n      payment,\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      verified: false,\r\n      error: error instanceof Error ? error.message : 'Verification failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Create a webhook signature for secure callbacks\r\n */\r\nexport function createWebhookSignature(\r\n  payload: string,\r\n  secret: string\r\n): string {\r\n  // In production, use proper HMAC-SHA256\r\n  // This is a placeholder - actual implementation would use crypto library\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(payload + secret);\r\n  let hash = 0;\r\n  for (let i = 0; i < data.length; i++) {\r\n    hash = ((hash << 5) - hash) + data[i];\r\n    hash = hash & hash;\r\n  }\r\n  return 'sha256=' + Math.abs(hash).toString(16).padStart(64, '0');\r\n}\r\n\r\n/**\r\n * Verify a webhook signature\r\n */\r\nexport function verifyWebhookSignature(\r\n  payload: string,\r\n  signature: string,\r\n  secret: string\r\n): boolean {\r\n  const expectedSignature = createWebhookSignature(payload, secret);\r\n  return signature === expectedSignature;\r\n}\r\n","/**\r\n * @aruvi/sdk\r\n * Official JavaScript SDK for Aruvi - Privacy-First Payments\r\n * \r\n * @example\r\n * // Initialize SDK\r\n * const aruvi = new Aruvi({\r\n *   merchantAddress: '0x...',\r\n *   environment: 'testnet',\r\n * });\r\n * \r\n * // Open checkout\r\n * aruvi.checkout({\r\n *   amount: '25.00',\r\n *   description: 'Premium Plan',\r\n *   onSuccess: (result) => {\r\n *     console.log('Payment successful!', result.paymentId);\r\n *   },\r\n *   onError: (error) => {\r\n *     console.error('Payment failed:', error.message);\r\n *   },\r\n * });\r\n */\r\n\r\nimport type {\r\n  AruviConfig,\r\n  PaymentRequest,\r\n  AruviCallbacks,\r\n  AruviButtonOptions,\r\n  PaymentResult,\r\n  PaymentError,\r\n  AruviEventType,\r\n  AruviEventHandler,\r\n  AruviEvent,\r\n} from './types';\r\nimport { CheckoutModal } from './CheckoutModal';\r\nimport { AruviButton, createAruviButton } from './AruviButton';\r\nimport { verifyPayment, verifyPaymentByTxHash } from './verify';\r\nimport { CONTRACTS, DEFAULTS } from './constants';\r\n\r\n// Re-export types\r\nexport type * from './types';\r\n\r\n// Re-export utilities\r\nexport { verifyPayment, verifyPaymentByTxHash } from './verify';\r\nexport { createAruviButton, AruviButton } from './AruviButton';\r\n\r\n/**\r\n * Main Aruvi SDK class\r\n */\r\nexport class Aruvi {\r\n  private config: AruviConfig;\r\n  private modal: CheckoutModal;\r\n  private eventListeners: Map<AruviEventType, Set<AruviEventHandler>> = new Map();\r\n\r\n  /**\r\n   * SDK Version\r\n   */\r\n  static readonly VERSION = '1.0.0';\r\n\r\n  /**\r\n   * Create a new Aruvi SDK instance\r\n   */\r\n  constructor(config: AruviConfig) {\r\n    if (!config.merchantAddress) {\r\n      throw new Error('Aruvi: merchantAddress is required');\r\n    }\r\n\r\n    if (!config.merchantAddress.startsWith('0x') || config.merchantAddress.length !== 42) {\r\n      throw new Error('Aruvi: Invalid merchantAddress format');\r\n    }\r\n\r\n    this.config = {\r\n      environment: 'testnet',\r\n      ...config,\r\n    };\r\n\r\n    this.modal = new CheckoutModal(this.config);\r\n  }\r\n\r\n  /**\r\n   * Open the checkout modal\r\n   */\r\n  checkout(\r\n    payment: PaymentRequest & AruviCallbacks\r\n  ): void {\r\n    const { onSuccess, onError, onCancel, onOpen, onClose, onPending, ...paymentData } = payment;\r\n\r\n    // Validate amount\r\n    if (!paymentData.amount || isNaN(parseFloat(paymentData.amount))) {\r\n      throw new Error('Aruvi: Valid amount is required');\r\n    }\r\n\r\n    const callbacks: AruviCallbacks = {\r\n      onSuccess: (result) => {\r\n        this.emit('payment:success', result);\r\n        onSuccess?.(result);\r\n      },\r\n      onError: (error) => {\r\n        this.emit('payment:error', error);\r\n        onError?.(error);\r\n      },\r\n      onCancel: () => {\r\n        this.emit('payment:cancel');\r\n        onCancel?.();\r\n      },\r\n      onOpen: () => {\r\n        this.emit('checkout:open');\r\n        onOpen?.();\r\n      },\r\n      onClose: () => {\r\n        this.emit('checkout:close');\r\n        onClose?.();\r\n      },\r\n      onPending: (txHash) => {\r\n        this.emit('payment:pending', { transactionHash: txHash });\r\n        onPending?.(txHash);\r\n      },\r\n    };\r\n\r\n    this.modal.open(paymentData, callbacks);\r\n  }\r\n\r\n  /**\r\n   * Close the checkout modal\r\n   */\r\n  closeCheckout(): void {\r\n    this.modal.close(true);\r\n  }\r\n\r\n  /**\r\n   * Check if checkout is open\r\n   */\r\n  isCheckoutOpen(): boolean {\r\n    return this.modal.isOpen();\r\n  }\r\n\r\n  /**\r\n   * Create a payment button\r\n   */\r\n  createButton(\r\n    container: HTMLElement | string,\r\n    payment: PaymentRequest & AruviCallbacks,\r\n    buttonOptions?: AruviButtonOptions\r\n  ): AruviButton {\r\n    const button = createAruviButton(container, buttonOptions);\r\n    \r\n    button.onClick(() => {\r\n      button.setLoading(true);\r\n      \r\n      this.checkout({\r\n        ...payment,\r\n        onSuccess: (result) => {\r\n          button.setLoading(false);\r\n          payment.onSuccess?.(result);\r\n        },\r\n        onError: (error) => {\r\n          button.setLoading(false);\r\n          payment.onError?.(error);\r\n        },\r\n        onCancel: () => {\r\n          button.setLoading(false);\r\n          payment.onCancel?.();\r\n        },\r\n        onClose: () => {\r\n          button.setLoading(false);\r\n          payment.onClose?.();\r\n        },\r\n      });\r\n    });\r\n\r\n    return button;\r\n  }\r\n\r\n  /**\r\n   * Generate a payment link\r\n   */\r\n  createPaymentLink(payment: PaymentRequest): string {\r\n    const appUrl = this.config.appUrl || DEFAULTS.appUrl[this.config.environment || 'testnet'];\r\n    const params = new URLSearchParams();\r\n    \r\n    params.set('to', this.config.merchantAddress);\r\n    params.set('amount', payment.amount);\r\n    \r\n    if (payment.reference) params.set('ref', payment.reference);\r\n    if (payment.description) params.set('desc', payment.description);\r\n    if (payment.metadata) params.set('meta', JSON.stringify(payment.metadata));\r\n    \r\n    return `${appUrl}/pay?${params.toString()}`;\r\n  }\r\n\r\n  /**\r\n   * Verify a payment\r\n   */\r\n  async verifyPayment(paymentId: `0x${string}`, expectedAmount?: string): Promise<boolean> {\r\n    const result = await verifyPayment({\r\n      paymentId,\r\n      merchantAddress: this.config.merchantAddress,\r\n      expectedAmount,\r\n      environment: this.config.environment,\r\n      rpcUrl: this.config.rpcUrl,\r\n    });\r\n    return result.verified;\r\n  }\r\n\r\n  /**\r\n   * Verify a payment by transaction hash\r\n   */\r\n  async verifyTransaction(transactionHash: `0x${string}`): Promise<boolean> {\r\n    const result = await verifyPaymentByTxHash(transactionHash, {\r\n      merchantAddress: this.config.merchantAddress,\r\n      environment: this.config.environment,\r\n      rpcUrl: this.config.rpcUrl,\r\n    });\r\n    return result.verified;\r\n  }\r\n\r\n  /**\r\n   * Add event listener\r\n   */\r\n  on(event: AruviEventType, handler: AruviEventHandler): () => void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set());\r\n    }\r\n    this.eventListeners.get(event)!.add(handler);\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.eventListeners.get(event)?.delete(handler);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Remove event listener\r\n   */\r\n  off(event: AruviEventType, handler: AruviEventHandler): void {\r\n    this.eventListeners.get(event)?.delete(handler);\r\n  }\r\n\r\n  /**\r\n   * Emit an event\r\n   */\r\n  private emit(type: AruviEventType, data?: any): void {\r\n    const event: AruviEvent = { type, data };\r\n    this.eventListeners.get(type)?.forEach((handler) => handler(event));\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): AruviConfig {\r\n    return { ...this.config };\r\n  }\r\n\r\n  /**\r\n   * Get contract addresses\r\n   */\r\n  getContracts() {\r\n    const env = this.config.environment || 'testnet';\r\n    return CONTRACTS[env as keyof typeof CONTRACTS];\r\n  }\r\n\r\n  /**\r\n   * Destroy the SDK instance\r\n   */\r\n  destroy(): void {\r\n    this.modal.destroy();\r\n    this.eventListeners.clear();\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UMD/Browser Global\r\n// ============================================================================\r\n\r\n/**\r\n * Global instance for simple usage\r\n */\r\nlet globalInstance: Aruvi | null = null;\r\n\r\n/**\r\n * Initialize the global Aruvi instance\r\n */\r\nexport function init(config: AruviConfig): Aruvi {\r\n  if (globalInstance) {\r\n    globalInstance.destroy();\r\n  }\r\n  globalInstance = new Aruvi(config);\r\n  return globalInstance;\r\n}\r\n\r\n/**\r\n * Get the global instance (must call init first)\r\n */\r\nexport function getInstance(): Aruvi {\r\n  if (!globalInstance) {\r\n    throw new Error('Aruvi: Call Aruvi.init() first');\r\n  }\r\n  return globalInstance;\r\n}\r\n\r\n/**\r\n * Quick checkout using global instance\r\n */\r\nexport function checkout(payment: PaymentRequest & AruviCallbacks): void {\r\n  getInstance().checkout(payment);\r\n}\r\n\r\n/**\r\n * Quick button creation using global instance\r\n */\r\nexport function button(\r\n  container: HTMLElement | string,\r\n  payment: PaymentRequest & AruviCallbacks,\r\n  options?: AruviButtonOptions\r\n): AruviButton {\r\n  return getInstance().createButton(container, payment, options);\r\n}\r\n\r\n// Default export\r\nexport default Aruvi;\r\n\r\n// For UMD builds, attach to window\r\nif (typeof window !== 'undefined') {\r\n  (window as any).Aruvi = {\r\n    Aruvi,\r\n    init,\r\n    getInstance,\r\n    checkout,\r\n    button,\r\n    createButton: createAruviButton,\r\n    verifyPayment,\r\n    verifyPaymentByTxHash,\r\n    VERSION: Aruvi.VERSION,\r\n  };\r\n}\r\n"],"names":["CONTRACTS","testnet","PaymentGateway","ConfidentialUSDCWrapper","chainId","chainName","rpcUrl","mainnet","DEFAULTS","appUrl","MESSAGE_TYPES","BUTTON_STYLES","base","sizes","small","medium","large","variants","primary","secondary","outline","dark","hover","disabled","ARUVI_LOGO_SVG","CheckoutModal","constructor","config","this","modal","iframe","callbacks","styleElement","messageHandler","injectStyles","document","getElementById","createElement","id","textContent","theme","customStyles","primaryColor","undefined","borderRadius","fontFamily","head","appendChild","getAppUrl","env","environment","buildCheckoutUrl","payment","baseUrl","params","URLSearchParams","set","merchantAddress","amount","reference","description","customerEmail","metadata","JSON","stringify","successUrl","cancelUrl","toString","createModal","overlay","className","setAttribute","container","header","title","innerHTML","closeBtn","onclick","close","content","loading","style","display","src","onload","e","target","escapeHandler","key","removeEventListener","addEventListener","setupMessageListener","event","origin","includes","URL","host","type","data","onPending","transactionHash","result","success","paymentId","customerAddress","blockNumber","timestamp","onSuccess","error","code","message","originalError","onError","window","open","body","overflow","onOpen","cancelled","remove","onClose","onCancel","isOpen","destroy","AruviButton","options","button","clickHandler","el","querySelector","Error","defaultOptions","render","getStyles","variant","size","styles","replace","trim","showLogo","label","onmouseenter","onmouseleave","onClick","handler","update","setLoading","enable","disable","getElement","createAruviButton","async","verifyPayment","contractAddress","slice","padStart","response","fetch","method","headers","jsonrpc","to","json","verified","decoded","hexData","length","sender","recipient","token","parseInt","isRefunded","decodePaymentResult","toLowerCase","formatUnits","value","decimals","str","whole","fraction","verifyPaymentByTxHash","receiptResponse","receiptResult","receipt","status","split","reduce","acc","char","charCodeAt","padEnd","paymentLog","logs","find","log","address","topics","BigInt","Date","now","Aruvi","eventListeners","Map","startsWith","checkout","paymentData","isNaN","parseFloat","emit","txHash","closeCheckout","isCheckoutOpen","createButton","buttonOptions","createPaymentLink","expectedAmount","verifyTransaction","on","has","Set","get","add","delete","off","forEach","getConfig","getContracts","clear","VERSION","globalInstance","init","getInstance"],"mappings":"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"}