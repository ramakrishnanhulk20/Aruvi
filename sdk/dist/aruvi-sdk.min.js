!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Aruvi={})}(this,function(e){"use strict";const t={testnet:{PaymentGateway:"0xf2Dd4FC2114e524E9B53d9F608e7484E1CD3271b",ConfidentialUSDCWrapper:"0xf99376BE228E8212C3C9b8B746683C96C1517e8B",chainId:11155111,chainName:"Sepolia",rpcUrl:"https://rpc.sepolia.org"},mainnet:{PaymentGateway:"0x...",ConfidentialUSDCWrapper:"0x...",chainId:1,chainName:"Ethereum",rpcUrl:"https://eth.llamarpc.com"}},n={appUrl:{testnet:"http://localhost:5173",mainnet:"https://app.aruvi.io"}},i="ARUVI_CHECKOUT_READY",s="ARUVI_CHECKOUT_CLOSED",r="ARUVI_PAYMENT_PENDING",o="ARUVI_PAYMENT_SUCCESS",a="ARUVI_PAYMENT_ERROR",c="ARUVI_PAYMENT_CANCELLED",l={base:"\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    border: none;\n    text-decoration: none;\n  ",sizes:{small:"\n      height: 36px;\n      padding: 0 16px;\n      font-size: 14px;\n      border-radius: 8px;\n    ",medium:"\n      height: 44px;\n      padding: 0 24px;\n      font-size: 15px;\n      border-radius: 10px;\n    ",large:"\n      height: 52px;\n      padding: 0 32px;\n      font-size: 16px;\n      border-radius: 12px;\n    "},variants:{primary:"\n      background: linear-gradient(135deg, #0070ba 0%, #003087 100%);\n      color: #ffffff;\n    ",secondary:"\n      background: #f5f7fa;\n      color: #003087;\n    ",outline:"\n      background: transparent;\n      color: #0070ba;\n      border: 2px solid #0070ba;\n    ",dark:"\n      background: #1a1a1a;\n      color: #ffffff;\n    "},hover:{primary:"filter: brightness(1.1); transform: translateY(-1px);",secondary:"background: #e8ecf2;",outline:"background: rgba(0, 112, 186, 0.08);",dark:"background: #2a2a2a;"},disabled:"\n    opacity: 0.5;\n    cursor: not-allowed;\n    pointer-events: none;\n  "},d='\n<svg width="24" height="24" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <circle cx="16" cy="16" r="14" fill="currentColor" opacity="0.2"/>\n  <path d="M10 20L16 12L22 20" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n  <path d="M13 16L16 12L19 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n';class u{constructor(e){this.modal=null,this.iframe=null,this.callbacks={},this.styleElement=null,this.messageHandler=null,this.config=e,this.injectStyles()}injectStyles(){if(!this.styleElement&&!document.getElementById("aruvi-modal-styles")){if(this.styleElement=document.createElement("style"),this.styleElement.id="aruvi-modal-styles",this.styleElement.textContent="\n  .aruvi-modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.6);\n    backdrop-filter: blur(4px);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 999999;\n    animation: aruvi-fade-in 0.2s ease;\n  }\n  \n  .aruvi-modal-container {\n    background: #ffffff;\n    border-radius: 16px;\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    width: 100%;\n    max-width: 420px;\n    max-height: 90vh;\n    overflow: hidden;\n    animation: aruvi-slide-up 0.3s ease;\n    position: relative;\n  }\n  \n  .aruvi-modal-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px 20px;\n    border-bottom: 1px solid #e5e7eb;\n    background: linear-gradient(135deg, #0070ba 0%, #003087 100%);\n    color: white;\n  }\n  \n  .aruvi-modal-title {\n    font-size: 18px;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n  \n  .aruvi-modal-close {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    width: 32px;\n    height: 32px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    transition: background 0.2s;\n  }\n  \n  .aruvi-modal-close:hover {\n    background: rgba(255, 255, 255, 0.3);\n  }\n  \n  .aruvi-modal-content {\n    padding: 0;\n  }\n  \n  .aruvi-modal-iframe {\n    width: 100%;\n    height: 500px;\n    border: none;\n  }\n  \n  .aruvi-modal-loading {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    height: 300px;\n    gap: 16px;\n    color: #6b7280;\n  }\n  \n  .aruvi-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid #e5e7eb;\n    border-top-color: #0070ba;\n    border-radius: 50%;\n    animation: aruvi-spin 1s linear infinite;\n  }\n  \n  @keyframes aruvi-fade-in {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n  \n  @keyframes aruvi-slide-up {\n    from { \n      opacity: 0; \n      transform: translateY(20px) scale(0.95); \n    }\n    to { \n      opacity: 1; \n      transform: translateY(0) scale(1); \n    }\n  }\n  \n  @keyframes aruvi-spin {\n    to { transform: rotate(360deg); }\n  }\n  \n  @media (max-width: 480px) {\n    .aruvi-modal-container {\n      max-width: 100%;\n      max-height: 100%;\n      height: 100%;\n      border-radius: 0;\n    }\n    \n    .aruvi-modal-iframe {\n      height: calc(100vh - 60px);\n    }\n  }\n",this.config.theme){let e="";this.config.theme.primaryColor&&(e+=`\n          .aruvi-modal-header {\n            background: ${this.config.theme.primaryColor};\n          }\n          .aruvi-spinner {\n            border-top-color: ${this.config.theme.primaryColor};\n          }\n        `),void 0!==this.config.theme.borderRadius&&(e+=`\n          .aruvi-modal-container {\n            border-radius: ${this.config.theme.borderRadius}px;\n          }\n        `),this.config.theme.fontFamily&&(e+=`\n          .aruvi-modal-overlay, .aruvi-modal-container {\n            font-family: ${this.config.theme.fontFamily};\n          }\n        `),this.styleElement.textContent+=e}document.head.appendChild(this.styleElement)}}getAppUrl(){if(this.config.appUrl)return this.config.appUrl;const e=this.config.environment||"testnet";return n.appUrl[e]}buildCheckoutUrl(e){const t=this.getAppUrl(),n=new URLSearchParams;return n.set("merchant",this.config.merchantAddress),n.set("amount",e.amount),n.set("sdk","true"),e.reference&&n.set("ref",e.reference),e.description&&n.set("desc",e.description),e.customerEmail&&n.set("email",e.customerEmail),e.metadata&&n.set("meta",JSON.stringify(e.metadata)),e.successUrl&&n.set("success",e.successUrl),e.cancelUrl&&n.set("cancel",e.cancelUrl),`${t}/checkout?${n.toString()}`}createModal(e){const t=document.createElement("div");t.className="aruvi-modal-overlay",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","aruvi-modal-title");const n=document.createElement("div");n.className="aruvi-modal-container";const i=document.createElement("div");i.className="aruvi-modal-header";const s=document.createElement("div");s.className="aruvi-modal-title",s.id="aruvi-modal-title",s.innerHTML=`${d} <span>Aruvi Checkout</span>`;const r=document.createElement("button");r.className="aruvi-modal-close",r.setAttribute("aria-label","Close checkout"),r.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n        <path d="M18 6L6 18M6 6l12 12"/>\n      </svg>\n    ',r.onclick=()=>this.close(!0),i.appendChild(s),i.appendChild(r);const o=document.createElement("div");o.className="aruvi-modal-content";const a=document.createElement("div");a.className="aruvi-modal-loading",a.innerHTML='\n      <div class="aruvi-spinner"></div>\n      <p>Loading secure checkout...</p>\n    ',o.appendChild(a);const c=document.createElement("iframe");c.className="aruvi-modal-iframe",c.style.display="none",c.src=this.buildCheckoutUrl(e),c.setAttribute("allow","clipboard-write; web3"),c.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"),c.onload=()=>{a.style.display="none",c.style.display="block"},o.appendChild(c),this.iframe=c,n.appendChild(i),n.appendChild(o),t.appendChild(n),t.onclick=e=>{e.target===t&&this.close(!0)};const l=e=>{"Escape"===e.key&&(this.close(!0),document.removeEventListener("keydown",l))};return document.addEventListener("keydown",l),t}setupMessageListener(){this.messageHandler=e=>{const t=this.getAppUrl();if(!e.origin.includes(new URL(t).host))return;const{type:n,data:l}=e.data||{};switch(n){case i:break;case r:this.callbacks.onPending?.(l.transactionHash);break;case o:const e={success:!0,paymentId:l.paymentId,transactionHash:l.transactionHash,amount:l.amount,customerAddress:l.customerAddress,merchantAddress:this.config.merchantAddress,blockNumber:l.blockNumber,timestamp:l.timestamp,reference:l.reference,metadata:l.metadata};this.callbacks.onSuccess?.(e),this.close(!1);break;case a:const t={code:l.code||"UNKNOWN",message:l.message||"Payment failed",originalError:l.originalError};this.callbacks.onError?.(t);break;case c:case s:this.close(!0)}},window.addEventListener("message",this.messageHandler)}open(e,t={}){this.modal&&this.close(!1),this.callbacks=t,this.modal=this.createModal(e),this.setupMessageListener(),document.body.appendChild(this.modal),document.body.style.overflow="hidden",this.callbacks.onOpen?.()}close(e=!1){this.modal&&(this.messageHandler&&(window.removeEventListener("message",this.messageHandler),this.messageHandler=null),this.modal.remove(),this.modal=null,this.iframe=null,document.body.style.overflow="",this.callbacks.onClose?.(),e&&this.callbacks.onCancel?.())}isOpen(){return null!==this.modal}destroy(){this.close(!1),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}}class h{constructor(e,t={}){if(this.button=null,this.clickHandler=null,"string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error(`Aruvi: Container element "${e}" not found`);this.container=t}else this.container=e;this.options={...h.defaultOptions,...t},this.render()}getStyles(){const{variant:e,size:t,disabled:n}=this.options;let i=l.base;return i+=l.sizes[t],i+=l.variants[e],n&&(i+=l.disabled),i.replace(/\s+/g," ").trim()}render(){this.button=document.createElement("button"),this.button.type="button",this.button.className=`aruvi-button ${this.options.className}`.trim(),this.button.disabled=this.options.disabled,this.button.setAttribute("style",this.getStyles());let e="";this.options.showLogo&&(e+=`<span class="aruvi-button-logo">${d}</span>`),e+=`<span class="aruvi-button-label">${this.options.label}</span>`,this.button.innerHTML=e;const t=this.options.variant;this.button.onmouseenter=()=>{!this.options.disabled&&this.button&&this.button.setAttribute("style",this.getStyles()+l.hover[t])},this.button.onmouseleave=()=>{this.button&&this.button.setAttribute("style",this.getStyles())},this.container.innerHTML="",this.container.appendChild(this.button)}onClick(e){return this.clickHandler=e,this.button&&(this.button.onclick=e),this}update(e){return this.options={...this.options,...e},this.render(),this.clickHandler&&this.onClick(this.clickHandler),this}setLoading(e){if(!this.button)return this;if(e){if(this.button.disabled=!0,this.button.innerHTML='\n        <span class="aruvi-spinner" style="\n          width: 20px;\n          height: 20px;\n          border: 2px solid currentColor;\n          border-top-color: transparent;\n          border-radius: 50%;\n          animation: aruvi-spin 1s linear infinite;\n        "></span>\n        <span>Processing...</span>\n      ',!document.getElementById("aruvi-button-styles")){const e=document.createElement("style");e.id="aruvi-button-styles",e.textContent="\n          @keyframes aruvi-spin {\n            to { transform: rotate(360deg); }\n          }\n        ",document.head.appendChild(e)}}else this.button.disabled=this.options.disabled,this.render(),this.clickHandler&&this.onClick(this.clickHandler);return this}enable(){return this.options.disabled=!1,this.button&&(this.button.disabled=!1,this.button.setAttribute("style",this.getStyles())),this}disable(){return this.options.disabled=!0,this.button&&(this.button.disabled=!0,this.button.setAttribute("style",this.getStyles())),this}getElement(){return this.button}destroy(){this.button&&(this.button.remove(),this.button=null),this.clickHandler=null}}function m(e,t){return new h(e,t)}async function p(e){const n=e.environment||"testnet",i=e.rpcUrl||t[n].rpcUrl,s=t[n].PaymentGateway;try{const t="0xc6610657"+e.paymentId.slice(2).padStart(64,"0"),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_call",params:[{to:s,data:t},"latest"]})}),r=await n.json();if(r.error)return{verified:!1,error:r.error.message||"RPC error"};const o=function(e){if(!e||"0x"===e||e.length<66)return null;const t=e.slice(2),n="0x"+t.slice(24,64),i="0x"+t.slice(88,128),s="0x"+t.slice(152,192),r=parseInt(t.slice(192,256),16),o=0!==parseInt(t.slice(256,320),16);if("0x0000000000000000000000000000000000000000"===n)return null;return{sender:n,recipient:i,token:s,timestamp:r,isRefunded:o}}(r.result);if(!o)return{verified:!1,error:"Payment not found"};if(o.recipient.toLowerCase()!==e.merchantAddress.toLowerCase())return{verified:!1,error:"Merchant address mismatch"};if(o.isRefunded)return{verified:!1,error:"Payment was refunded"};return{verified:!0,payment:{success:!0,paymentId:e.paymentId,transactionHash:"0x",amount:"0",customerAddress:o.sender,merchantAddress:o.recipient,blockNumber:0,timestamp:o.timestamp}}}catch(e){return{verified:!1,error:e instanceof Error?e.message:"Verification failed"}}}function f(e,t){const n=e.toString().padStart(t+1,"0"),i=n.slice(0,-t)||"0",s=n.slice(-t).replace(/0+$/,"");return s?`${i}.${s}`:i}async function b(e,n){const i=n.environment||"testnet",s=n.rpcUrl||t[i].rpcUrl;try{const r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_getTransactionReceipt",params:[e]})}),o=await r.json();if(o.error||!o.result)return{verified:!1,error:"Transaction not found"};const a=o.result;if("0x1"!==a.status)return{verified:!1,error:"Transaction failed"};"PaymentSent(bytes32,address,address,uint256)".split("").reduce((e,t)=>e+t.charCodeAt(0).toString(16),"").padEnd(64,"0");const c=a.logs?.find(e=>e.address.toLowerCase()===t[i].PaymentGateway.toLowerCase());if(!c)return{verified:!1,error:"Payment event not found in transaction"};const l=c.topics[1],d="0x"+c.topics[2].slice(26),u="0x"+c.topics[3].slice(26),h=BigInt(c.data);if(u.toLowerCase()!==n.merchantAddress.toLowerCase())return{verified:!1,error:"Merchant address mismatch"};return{verified:!0,payment:{success:!0,paymentId:l,transactionHash:e,amount:f(h,6),customerAddress:d,merchantAddress:u,blockNumber:parseInt(a.blockNumber,16),timestamp:Date.now()}}}catch(e){return{verified:!1,error:e instanceof Error?e.message:"Verification failed"}}}h.defaultOptions={label:"Pay with Aruvi",variant:"primary",size:"medium",showLogo:!0,disabled:!1,className:""};class g{constructor(e){if(this.eventListeners=new Map,!e.merchantAddress)throw new Error("Aruvi: merchantAddress is required");if(!e.merchantAddress.startsWith("0x")||42!==e.merchantAddress.length)throw new Error("Aruvi: Invalid merchantAddress format");this.config={environment:"testnet",...e},this.modal=new u(this.config)}checkout(e){const{onSuccess:t,onError:n,onCancel:i,onOpen:s,onClose:r,onPending:o,...a}=e;if(!a.amount||isNaN(parseFloat(a.amount)))throw new Error("Aruvi: Valid amount is required");const c={onSuccess:e=>{this.emit("payment:success",e),t?.(e)},onError:e=>{this.emit("payment:error",e),n?.(e)},onCancel:()=>{this.emit("payment:cancel"),i?.()},onOpen:()=>{this.emit("checkout:open"),s?.()},onClose:()=>{this.emit("checkout:close"),r?.()},onPending:e=>{this.emit("payment:pending",{transactionHash:e}),o?.(e)}};this.modal.open(a,c)}closeCheckout(){this.modal.close(!0)}isCheckoutOpen(){return this.modal.isOpen()}createButton(e,t,n){const i=m(e,n);return i.onClick(()=>{i.setLoading(!0),this.checkout({...t,onSuccess:e=>{i.setLoading(!1),t.onSuccess?.(e)},onError:e=>{i.setLoading(!1),t.onError?.(e)},onCancel:()=>{i.setLoading(!1),t.onCancel?.()},onClose:()=>{i.setLoading(!1),t.onClose?.()}})}),i}createPaymentLink(e){const t=this.config.appUrl||n.appUrl[this.config.environment||"testnet"],i=new URLSearchParams;return i.set("to",this.config.merchantAddress),i.set("amount",e.amount),e.reference&&i.set("ref",e.reference),e.description&&i.set("desc",e.description),e.metadata&&i.set("meta",JSON.stringify(e.metadata)),`${t}/pay?${i.toString()}`}async verifyPayment(e,t){return(await p({paymentId:e,merchantAddress:this.config.merchantAddress,expectedAmount:t,environment:this.config.environment,rpcUrl:this.config.rpcUrl})).verified}async verifyTransaction(e){return(await b(e,{merchantAddress:this.config.merchantAddress,environment:this.config.environment,rpcUrl:this.config.rpcUrl})).verified}on(e,t){return this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t),()=>{this.eventListeners.get(e)?.delete(t)}}off(e,t){this.eventListeners.get(e)?.delete(t)}emit(e,t){const n={type:e,data:t};this.eventListeners.get(e)?.forEach(e=>e(n))}getConfig(){return{...this.config}}getContracts(){const e=this.config.environment||"testnet";return t[e]}destroy(){this.modal.destroy(),this.eventListeners.clear()}}g.VERSION="1.0.0";let y=null;function v(e){return y&&y.destroy(),y=new g(e),y}function w(){if(!y)throw new Error("Aruvi: Call Aruvi.init() first");return y}function x(e){w().checkout(e)}function k(e,t,n){return w().createButton(e,t,n)}"undefined"!=typeof window&&(window.Aruvi={Aruvi:g,init:v,getInstance:w,checkout:x,button:k,createButton:m,verifyPayment:p,verifyPaymentByTxHash:b,VERSION:g.VERSION}),e.Aruvi=g,e.AruviButton=h,e.button=k,e.checkout=x,e.createAruviButton=m,e.default=g,e.getInstance=w,e.init=v,e.verifyPayment=p,e.verifyPaymentByTxHash=b,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=aruvi-sdk.min.js.map
